name: Release iOS
description: Release iOS App

inputs:
    new-arch-enabled:
        description: "Flag that tells whether enable support to the new architecture."
        required: true
    version-number:
        description: "The current version number"
        required: true
    build-number:
        description: "The current build number"
        required: true

runs:
    using: composite
    steps:
        - name: Set up Node
          uses: ./.github/actions/setup-node
          with:
              registry-url: ${{ env.PRIVATE_NPM_REPOSITORY_URL }}
              new-arch-enabled: ${{ inputs.new-arch-enabled }}

        - name: Set up iOS
          uses: ./.github/actions/setup-ios

        - name: Update Configuration
          uses: ./.github/actions/update-config
          with:
              host-name: ${{ env.HOST_NAME }}

        - name: Publish iOS App
          if: ${{ env.BUILD_TYPE == 'RELEASE' || env.BUILD_TYPE == 'SNAPSHOT' }}
          uses: maierj/fastlane-action@v3.1.0
          with:
              lane: ${{ env.BUILD_TYPE == 'RELEASE' && 'main' || 'develop' }}
              subdirectory: 'ios'
              options: |
                {
                  "version": "${{ inputs.version-number }}",
                  "build_number": "${{ inputs.build-number }}",
                  "new_arch_enabled": "${{ inputs.new-arch-enabled }}"
                }
